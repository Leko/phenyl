// @flow
import type {
  RequestData
} from './request-data.js.flow'

import type {
  ResponseData
} from './response-data.js.flow'

import type {
  ServerError
} from './error.js.flow'

import type {
  TypeMap
} from './type-map.js.flow'

import type {
  VersionDiff,
  VersionDiffSubscriber,
  SubscriptionRequest,
  SubscriptionResult,
} from './versioning.js.flow'

import type {
  RestApiHandler
} from './rest-api-handler.js.flow'

export type WebSocketClientMessage<N: string, TM: TypeMap> = WebSocketClientRequestDataMessage<N, TM> | WebSocketClientSubscriptionRequestMessage

export type WebSocketClientRequestDataMessage<N: string, TM: TypeMap> = {|
  reqData: RequestData<N, TM>,
  tag: string,
|}

export type WebSocketClientSubscriptionRequestMessage = {|
  subscription: SubscriptionRequest,
  tag: string,
|}

export type WebSocketServerMessage<N: string, TM: TypeMap> =
  WebSocketServerResponseDataMessage<N, TM> |
  WebSocketServerVersionDiffMessage |
  WebSocketServerSubscriptionResultMessage |
  WebSocketServerErrorMessage

export type WebSocketServerResponseDataMessage<N: string, TM: TypeMap> = {|
  resData: ResponseData<N, TM>,
  tag: string,
|}

export type WebSocketServerVersionDiffMessage = {|
  versionDiff: VersionDiff,
|}

export type WebSocketServerSubscriptionResultMessage = {|
  subscriptionResult: SubscriptionResult,
  tag: string,
|}

export type WebSocketServerErrorMessage = {|
  error: ServerError,
  tag: ?string,
|}

export type WebSocketServerParams<TM: TypeMap> = {
  restApiHandler: RestApiHandler<TM>,
  versionDiffSubscriber?: VersionDiffSubscriber
}
